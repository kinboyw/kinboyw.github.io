<!DOCTYPE html><html class="theme-next gemini use-motion" lang="ZH | EN"><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="AKuwh4i11uWg0wOl_cM7AI_dHqOHOLKYfCxKc8Lfv6E"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="FE,CSS,"><link rel="alternate" href="/atom.xml" title="Kinboy's note" type="application/atom+xml"><meta name="description" content="原文：Element size and scrolling   我们可以从很多 JavaScript 属性中得到关于元素宽度，高度和几何特性的信息。 当在 JavaScript 中移动或者定位元素时，我们需要这些信息来计算坐标。"><meta name="keywords" content="FE,CSS"><meta property="og:type" content="article"><meta property="og:title" content="CSS元素尺寸与滚动"><meta property="og:url" content="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/index.html"><meta property="og:site_name" content="Kinboy&#39;s note"><meta property="og:description" content="原文：Element size and scrolling   我们可以从很多 JavaScript 属性中得到关于元素宽度，高度和几何特性的信息。 当在 JavaScript 中移动或者定位元素时，我们需要这些信息来计算坐标。"><meta property="og:locale" content="ZH | EN"><meta property="og:image" content="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/metric-all@2x.png"><meta property="og:image" content="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/metric-css@2x.png"><meta property="og:image" content="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/metric-all@2x.png"><meta property="og:image" content="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/metric-offset-parent@2x.png"><meta property="og:image" content="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/metric-offset-width-height@2x.png"><meta property="og:image" content="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/metric-client-left-top@2x.png"><meta property="og:image" content="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/metric-client-left-top-rtl@2x.png"><meta property="og:image" content="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/metric-client-width-height@2x.png"><meta property="og:image" content="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/metric-client-width-nopadding@2x.png"><meta property="og:image" content="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/metric-scroll-width-height@2x.png"><meta property="og:updated_time" content="2019-07-15T10:05:10.316Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="CSS元素尺寸与滚动"><meta name="twitter:description" content="原文：Element size and scrolling   我们可以从很多 JavaScript 属性中得到关于元素宽度，高度和几何特性的信息。 当在 JavaScript 中移动或者定位元素时，我们需要这些信息来计算坐标。"><meta name="twitter:image" content="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/metric-all@2x.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!0,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"I didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/"><title>CSS元素尺寸与滚动 | Kinboy's note</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c9c2b9e915e6bb8ec323a2f98c0c98d8";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><body itemscope itemtype="http://schema.org/WebPage" lang="ZH | EN"><div class="container sidebar-position-left page-post-detail"><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"></span><span class="site-title">Kinboy's note</span><span class="logo-line-after"></span></a></div><h1 class="site-subtitle" itemprop="description">前端漫记</h1></div><div class="site-nav-toggle"><button></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><br>Home</a><li class="menu-item menu-item-about"><a href="/rscard/" rel="section"><br>About</a><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><br>Tags</a><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><br>Categories</a><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><br>Archives</a><li class="menu-item menu-item-top"><a href="/top/" rel="section"><br>Top</a><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><br>Search</a></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"></span><span class="popup-btn-close"></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input"></div></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-categories" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="kinboy"><meta itemprop="description" content><meta itemprop="image" content="/images/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Kinboy's note"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">CSS元素尺寸与滚动</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"></span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-02T00:20:04+08:00">2018-12-02</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/FE/" itemprop="url" rel="index"><span itemprop="name">FE</span></a></span> , <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/FE/CSS/" itemprop="url" rel="index"><span itemprop="name">CSS</span></a></span></span> <span class="post-comments-count"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"></span><a href="/2018/12/02/CSS元素尺寸与滚动/#comments" itemprop="discussionUrl"></a></span><div class="post-wordcount"><span class="post-meta-item-icon"></span><span class="post-meta-item-text">Words count in article&#58;</span> <span title="Words count in article">3.8k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"></span> <span class="post-meta-item-text">Reading time &asymp;</span> <span title="Reading time">15</span></div></div></header><div class="post-body" itemprop="articleBody"><p>原文：<a href="http://javascript.info/size-and-scroll" target="_blank" rel="noopener">Element size and scrolling</a></p><img src="/2018/12/02/CSS元素尺寸与滚动/metric-all@2x.png" width="600"><p>我们可以从很多 JavaScript 属性中得到关于元素宽度，高度和几何特性的信息。<p>当在 JavaScript 中移动或者定位元素时，我们需要这些信息来计算坐标。</p><h2 id="示例元素">示例元素</h2><p>我们将用会用下面的示例元素来演示这些属性：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"example"</span>&gt;</span></span><br><span class="line">  ...Text...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-id">#example</span> &#123;</span></span><br><span class="line">    width: 300px;</span><br><span class="line">    height: 200px;</span><br><span class="line"><span class="css">    <span class="selector-tag">border</span>: 25<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#E8C48F</span>;</span></span><br><span class="line">    padding: 20px;</span><br><span class="line">    overflow: auto;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></table></figure><p>示例元素包含了 border，padding以及 scrolling。全套特性。这里没有 margin ，因为 margin 并不属于元素本身的一部分，对元素来说也不是特殊的属性。<p>这个元素长这样：</p><img src="/2018/12/02/CSS元素尺寸与滚动/metric-css@2x.png" width="600"><p>你可以 <a href="http://plnkr.co/edit/mqrTzVMfm5Qk7eaaENTH?p=preview" target="_blank" rel="noopener">在sandbox中打开文档</a>。<blockquote><p>注意滚动条<p>上面这幅图展示了当元素包含一个滚动条时的最复杂的情况。一些浏览器（并不是所有）通过占据元素的空间来为滚动条保留空间。<p>所以，有滚动条的情况下，内容宽度是 <code>300px</code>，但是如果滚动条是 <code>16px</code> 宽（宽度可能会因浏览器或者设备而不同）则内容宽度就只会剩 <code>300-16 = 284px</code> ，我们应该考虑滚动条的宽度。这就是为什么这个示例中会包含一个滚动条。如果没有滚动条，事情就会简单一些了。</blockquote><blockquote><p><code>padding-bottom</code> 可能会填充文字<p>通常情况下 padding 在插图中显示的是空白的，但是如果元素中存在大量文字，并且溢出了，浏览器就会在 <code>padding-bottom</code> 中显示溢出的文字，于是你就可以看到了。但是 padding 仍然存在于那里的，除非有其他指定。</blockquote><h2 id="几何">几何</h2><p>提供宽度，高度以及其几何性质的元素属性的值都是数字。一般认为他们的单位是像素。<p>这里是整体的图片：</p><img src="/2018/12/02/CSS元素尺寸与滚动/metric-all@2x.png" width="600"><p>这里有很多属性，很难将它们展示在同一张图片中，但是他们的值很简单，也很容易理解。<p>我们从外向内来探索它们。<h2 id="offsetParent-offsetLeft-Top">offsetParent, offsetLeft/Top</h2><p>这些属性很少需要用到，但是他们是最外层的几何属性，所以我们从它们开始说。<p><code>offsetParent</code> 是距离最近的一个满足下述条件的祖先元素：<ol><li>具有 CSS 定位（<code>position</code> 为 <code>absolute</code>， <code>relative</code>， <code>fixed</code> 或者 <code>sticky</code>），<li>或者 <code>&lt;td&gt;</code>， <code>&lt;th&gt;</code>， <code>&lt;table&gt;</code>，<li>或者 <code>&lt;body&gt;</code>。</ol><p>在大多数实际情况下，我们可以使用 <code>offsetParent</code> 来得到最近的 <code>CSS 定位的</code> 祖先元素。并且 <code>offsetLeft / offsetTop</code> 提供了相对于它的左上角的 x / y 坐标。<p>在下面的例子中，内部的 <code>&lt;div&gt;</code> 有一个 <code>&lt;main&gt;</code> 作为 <code>offsetParent</code> ， 并且 <code>offsetLeft / offsetTop</code> 从它的左上角移开了（<code>180</code>像素）:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre><td class="code"><pre><span class="line">&lt;main style=&quot;position: relative&quot; id=&quot;main&quot;&gt;</span><br><span class="line">  &lt;article&gt;</span><br><span class="line">    &lt;div id=&quot;example&quot; style=&quot;position: absolute; left: 180px; top: 180px&quot;&gt;...&lt;/div&gt;</span><br><span class="line">  &lt;/article&gt;</span><br><span class="line">&lt;/main&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  alert(example.offsetParent.id); // main</span><br><span class="line">  alert(example.offsetLeft); // 180 (note: a number, not a string &quot;180px&quot;)</span><br><span class="line">  alert(example.offsetTop); // 180</span><br><span class="line">&lt;/script&gt;</span><br></pre></table></figure><img src="/2018/12/02/CSS元素尺寸与滚动/metric-offset-parent@2x.png" width="600"><p>有几种情况下 <code>offsetParent</code> 为 <code>null</code> ：<ol><li>对于未显示的元素（<code>display:none</code> 或者不在文档中）。<li>对于 <code>&lt;body&gt;</code> 和 <code>&lt;html&gt;</code> 元素。<li>对于 <code>position:fixed</code> 的元素。</ol><h2 id="offsetWidth-Height"><a href="http://javascript.info/size-and-scroll#offsetwidth-height" target="_blank" rel="noopener">offsetWidth/Height</a></h2><p>现在我们来看看元素本身。<p>这两个属性是最简单的。它们提供了元素的<code>外部</code> width/height。或者，换句话说，包含 border 的完整尺寸。</p><img src="/2018/12/02/CSS元素尺寸与滚动/metric-offset-width-height@2x.png" width="600"><p>对于我们的示例元素：<ul><li><code>offsetWidth = 390</code> – 外部宽度，可以计算为内部宽度（<code>300px</code>） + padding（<code>2*20px</code>）+ border （<code>2*25px</code>）。<li><code>offsetHeight = 290</code> – 外部高度。</ul><p>未显示的几何属性的值为 0/null<p>几何属性只计算已显示的元素。<p>如果一个元素（或者它的任意祖先）有 <code>display:none</code> 或者不在文档中，则所有几何属性都是 0 或者 <code>null</code>，0 或者 <code>null</code> 取决于这个属性是什么。<p>例如，<code>offsetParent</code> 是 <code>null</code> ，<code>offsetWidth</code> ，<code>offsetHeight</code> 是 <code>0</code>。<p>我们可以用这个来检查一个元素是否隐藏，像这样：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isHidden</span>(<span class="params">elem</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !elem.offsetWidth &amp;&amp; !elem.offsetHeight;</span><br><span class="line">&#125;</span><br></pre></table></figure><p>请注意，这个 <code>isHidden</code> 对于没有显示在屏幕上，但是大小为 0 的元素（例如一个空的 <code>&lt;div&gt;</code>）返回 <code>true</code> 。<h2 id="clientTop-Left"><a href="http://javascript.info/size-and-scroll#clienttop-left" target="_blank" rel="noopener">clientTop/Left</a></h2><p>在这个元素内部，我们有 border 属性。<p>有 <code>clientTop</code> 和 <code>clientLeft</code> 属性可以用来测量它们。<p>在我们的示例中：<ul><li><p><code>clientLeft = 25</code> – 左边框宽度<li><p><code>clientTop = 25</code> – 上边框宽度</ul><img src="/2018/12/02/CSS元素尺寸与滚动/metric-client-left-top@2x.png" width="600"><p>但是确切地说，它们并不是 border ，只是内侧于外侧的相对坐标。<p>有什么区别？<p>当文档是从右指至左（操作系统时阿拉伯语或者希伯来语）时可见。滚动条将不会出现在右侧，而是在左侧，<code>clientLeft</code> 也包括了滚动条宽度。<p>在这种情况下， <code>clientLeft</code> 就不是 <code>25</code> 而是加上滚动条的宽度 <code>25+16=41</code>：</p><img src="/2018/12/02/CSS元素尺寸与滚动/metric-client-left-top-rtl@2x.png" width="600"><h2 id="clientWidth-Height">clientWidth/Height</h2><p>这些属性提供了元素边界内部区域的尺寸。<p>它们包括了内容宽度，也包括了 padding ，但是不包括滚动条宽度：</p><img src="/2018/12/02/CSS元素尺寸与滚动/metric-client-width-height@2x.png" width="600"><p>在上面的图中，我们先看看 <code>clientHeight</code>：很容易计算。这里没有横向滚动条，所以就是边界内部各种长度的综合：CSS 高度 <code>200px</code> + top 和 bottom padding （2*20px），总共是 <code>240px</code>。<p>现在计算 <code>clientWidth</code> ，内容宽度不是 <code>300px</code>，而是 <code>284px</code>，<code>16px</code> 被滚动条占用了。所以 <code>284px</code> + 左右 padding ，总共是 <code>324px</code>。<p><strong>如果没有 <code>padding</code> ，那么 clientWidth / Height 就直接是边界内部的内容区域和滚动条（如果存在）的宽度/高度。</strong></p><img src="/2018/12/02/CSS元素尺寸与滚动/metric-client-width-nopadding@2x.png"><p>所以当不存在 padding 时，我们可以用 <code>clientWidth / clientHeight</code> 来得到内容区域的大小。<h2 id="scrollWidth-Height">scrollWidth/Height</h2><ul><li>属性 <code>clientWidth / clientHeight</code> 只对元素的可视部分有效。<li>元素 <code>scrollWidth / scrollHeight</code> 也包括了滚出（隐藏）的部分：</ul><img src="/2018/12/02/CSS元素尺寸与滚动/metric-scroll-width-height@2x.png" width="600"><p>在上面的图中：<ul><li><code>scrollHeight = 723</code> – 是整个内容区域包括滚出部分的内部高度。<li><code>scrollWidth = 324</code> – 是整个内部宽度，这里我们没有横向滚动条，所以它就等于 <code>clientWidth</code>。</ul><p>我们可以用这些属性来将元素宽度扩展为整个的宽度/高度。<p>像这样:<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre><td class="code"><pre><span class="line"><span class="comment">// 将元素扩展到整个内容的宽度</span></span><br><span class="line">element.style.height = <span class="string">`<span class="subst">$&#123;element.scrollHeight&#125;</span>px`</span>;</span><br></pre></table></figure><p>点击按钮来展开元素：<div id="element" style="width:300px;height:300px;margin:0 auto;padding:0;overflow:auto;border:1px solid #000">text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text text</div><p style="margin:0 auto;text-align:center"><button style="padding:0" onclick="element.style.height = `${element.scrollHeight}px`">element.style.height =</button><code>${element.scrollHeight}px</code><h2 id="scrollLeft-scrollTop"><a href="http://javascript.info/size-and-scroll#scrollleft-scrolltop" target="_blank" rel="noopener">scrollLeft/scrollTop</a></h2><p>属性 <code>scrollLeft / scrollTop</code> 是元素中隐藏的，滚出部分的 width/height。<p>在下面的图片中，我们可以看到一个具有垂直滚动条的块的 <code>scrollHeight</code> 和 <code>scrollTop</code> 。<p>换句话说，<code>scrollTop</code> 其实是 <code>向上滚动了多少</code>。<blockquote><p><code>scrollLeft/scrollTop</code> 可以被修改。<p>大多数几何属性都是只读的，但是 <code>scrollLeft/scrollTop</code> 可以被修订，并且浏览器将会滚动元素。<p>如果你点击下面的元素，代码 <code>elem.scrollTop +=10</code> 会执行。这会使元素内容向下滚动 <code>10px</code>。</p>> ><div onclick="this.scrollTop+=10" style="cursor:pointer;border:1px solid #000;width:100px;height:80px;overflow:auto">Click<br>Me<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9</div>> ><p>设置 <code>scrollTop</code> 为 <code>0</code> 或者 <code>Infinity</code> 将会分别使元素滚动到 <code>top/bottom</code> 的位置。</blockquote><h2 id="不要用-CSS-取-width-height">不要用 CSS 取 width/height</h2><p>我们刚刚讲了 DOM 元素的几何属性。它们通常被用来获取宽度，高度以及计算 距离。<p>但是我们从 <a href="http://javascript.info/styles-and-classes" target="_blank" rel="noopener">Style and classes</a> 这一章知道了，可以用 <code>getComputedStyle</code> 来获取 CSS 的高度和宽度。<p>所以，为什么不能像这样读取元素的宽度呢？<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre><td class="code"><pre><span class="line"><span class="keyword">let</span> elem = <span class="built_in">document</span>.body;</span><br><br><span class="line">alert( getComputedStyle(elem).width ); <span class="comment">// show CSS width for elem</span></span><br></pre></table></figure><p>为什么我们应该使用几何属性？有两个原因：<ol><li>首先，CSS 的 <code>width/height</code> 决定于另外一个属性：定义了 CSS 的 width 和 height “是什么的”<code>box-sizing</code> 。一个出于某种 CSS 目的的对 <code>box-sizing</code> 的改动就可能破坏了这段 JavaScript 代码。<li><p>第二，CSS <code>width/height</code> 可能是 <code>auto</code>，例如一个 <code>inline</code> 元素：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"elem"</span>&gt;</span>Hello!<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  alert( getComputedStyle(elem).width ); <span class="comment">// auto</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></table></figure></ol><p>站在 CSS 的角度来看，<code>width:auto</code> 是非常正常的，但是在 JavaScript 中我们需要一个可以用来计算的精确的像素尺寸。所以这种情况下 CSS width 一点用处都没有。<p>也有一些其他的原因：滚动条。有时候代码在没有滚动条的时候工作地很好，出现滚动条时就出问题了，因为滚动条会在一些浏览器中会占据内容的空间。所以内容真正可用的空间比 CSS width 要少。 <code>clientWidth / clientHeight</code> 会考虑这一点。<p>但是对于 <code>getComputedStyle(elem).width</code> ，情况就不同了。一些浏览器（例如，Chrome）返回真正的实际的内部宽度，负的滚动条，一些浏览器（例如，火狐）返回 CSS width（忽略滚动条）。这样的跨浏览器差异就是不要使用 <code>getComputedStyle</code> ，而是依靠几何属性的原因。<p>如果你的浏览器保留了滚动条的空间（Windows的大多数浏览器都有），那么你可以在下面测试。</p><iframe class="code-result__iframe" data-trusted="1" src="https://en.js.cx/article/size-and-scroll/cssWidthScroll/" style="text-shadow:#999 .01em .01em .01em!important;display:block;border:0;width:798px;height:300px;margin:0 auto;font-family:微软雅黑!important"></iframe><p>这个填充文字的元素有 CSS <code>width:300px</code>。<p>在一个 Windows 桌面操作系统中，Firefox，Chrome，Edge 全部保留了滚动条的空间。但是Firefox 显示 <code>300px</code> ，而 Chrome 和 Edge 显示的更少。这是因为 Firefox 返回的是 CSS width，其他浏览器返回的是 <code>实际</code> 宽度。<p>请注意，我们所说的只是关于用 JavaScript 读取 <code>getComputedStyle(elem).width</code>的差异 ，视觉上这些都是正确的。<h2 id="总结">总结</h2><p>元素有下面这些几何属性：<ul><li><code>offsetParent</code> – 是距离最近的 <code>定位</code> 的祖先，或者 <code>td</code>, <code>th</code>, <code>table</code>, <code>body</code>。<li><code>offsetLeft/offsetTop</code> – 相对于 <code>offsetParent</code> 左上角的坐标。<li><code>offsetWidth/offsetHeight</code> – 一个元素包含 border 的“外部” width/height 。<li><code>clientLeft/clientTop</code> – 从左上外角到左上内角的距离。对于从左至右的操作系统，它们总是左/上边界的宽度。对于从右至左的操作系统，垂直滚动条在左侧，所以 <code>clientLeft</code> 也包含滚动条的宽度。<li><code>clientWidth/clientHeight</code> – 内容的 <code>width/height</code> ，包括 padding 但是不包括滚动条。<li><code>scrollWidth/scrollHeight</code> – 内容的 <code>width/height</code> 包括滚出去的部分。也包括 padding 但是不包括滚动条。<li><code>scrollLeft/scrollTop</code> – 元素滚出部分的 <code>width/heigh</code> ，从左上角开始。</ul><p>All properties are read-only except <code>scrollLeft/scrollTop</code>. They make the browser scroll the element if changed.<p>所有属性都是只读的，除了 <code>scrollLeft/scrollTop</code>。如果发生改变，会让浏览器滚动元素。<h2 id="任务">任务</h2><h3 id="底部滚动距离是多少？">底部滚动距离是多少？</h3><p>难度: 5<p><code>elem.scrollTop</code> 属性是滚出部分的大小。如何得到 “<code>scrollBottom</code> ” — 也就是到底部的距离？<p>写出对任意一个元素 <code>elem</code> 有效的代码。<p>P.S. 请检查代码：如果元素没有滚动，或者滚到底了，就要返回 <code>0</code>。<blockquote><p>答案:<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre><td class="code"><pre><span class="line">&gt; <span class="keyword">let</span> scrollBottom = elem.scrollHeight - elem.scrollTop - elem.clientHeight;</span><br><span class="line">&gt;</span><br></pre></table></figure></blockquote><blockquote><p>也就是: (全部高度) - (滚出的顶部高度) - (可见部分) – 这就是底部滚出距离。</blockquote><h3 id="滚动条宽度是多少？">滚动条宽度是多少？</h3><p>难度: 3<p>写代码，返回滚动条宽度：<p>对于 Windows 操作系统，这个值在 <code>12px</code> 和 <code>20px</code> 之间。如果浏览器不保留滚动条宽度，就可能是 <code>0px</code>。<p>P.S. 代码应该对任何 HTML 文档有效，不取决于内容。<blockquote><p>为了得到滚动条宽度，我们可以创建一个元素，有滚动条，但是没有 border 和 padding 。<p>全宽 <code>offsetWidth</code> 和内容区域的宽度 <code>clientWidth</code> 之差就是滚动条的宽度了：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre><td class="code"><pre><span class="line">&gt; <span class="comment">// create a div with the scroll</span></span><br><span class="line">&gt; <span class="keyword">let</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">&gt; </span><br><span class="line">&gt; div.style.overflowY = <span class="string">'scroll'</span>;</span><br><span class="line">&gt; div.style.width = <span class="string">'50px'</span>;</span><br><span class="line">&gt; div.style.height = <span class="string">'50px'</span>;</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="comment">// must put it in the document, otherwise sizes will be 0</span></span><br><span class="line">&gt; <span class="built_in">document</span>.body.append(div);</span><br><span class="line">&gt; <span class="keyword">let</span> scrollWidth = div.offsetWidth - div.clientWidth;</span><br><span class="line">&gt; </span><br><span class="line">&gt; div.remove();</span><br><span class="line">&gt; </span><br><span class="line">&gt; alert(scrollWidth);</span><br><span class="line">&gt;</span><br></pre></table></figure></blockquote><h3 id="将球放到草坪中间">将球放到草坪中间</h3><p>难度: 5<p>这是原始文档的样子：</p><iframe class="code-result__iframe" data-trusted="1" src="https://en.js.cx/task/put-ball-in-center/source/" style="text-shadow:#999 .01em .01em .01em!important;display:block;border:0;width:798px;height:180px;font-family:微软雅黑!important"></iframe><p>草坪中心的坐标是多少？<p>计算中心坐标，然后将球放到草坪中心:</p><iframe class="code-result__iframe" data-trusted="1" src="https://en.js.cx/task/put-ball-in-center/solution/" style="text-shadow:#999 .01em .01em .01em!important;display:block;border:0;width:798px;height:180px;font-family:微软雅黑!important"></iframe><ul><li>元素应该用 JavaScript 移动， 而不是 CSS。<li>代码应该适用于任意大小的球（<code>10</code>， <code>20</code>， <code>30</code> 像素），任意大小的草坪，不应该只是给定的值。</ul><p>P.S. 当然，居中可以用 CSS 实现，但是这里我们只想用 JavaScript 。以后我们将会碰到其他的话题和更复杂的情况只能用 JavaScript。这里我们只是一个“热身”。<p><a href="http://plnkr.co/edit/qTjKtFDHyRUVAD2DINIp?p=preview" target="_blank" rel="noopener">在sandbox中查看任务</a><blockquote><p>这个球有 <code>position:absolute</code> ，意味着它的 <code>left/top</code> 坐标是相对于最近的定位祖先元素，那就是<code>#草坪</code> （因为它有 <code>position:relative</code>）。<p>坐标从草坪内部的左上角开始：<p>草坪内部的 width/height 是 <code>clientWidth/clientHeight</code>所以草坪中心坐标是 <code>(clientWidth/2, clientHeight/2)</code>。<p>…但是如果我们设置 <code>ball.style.left/top</code> 为这样的值，那么并不是整个球，而是这个球的左上边缘在中间了:<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre><td class="code"><pre><span class="line">&gt; ball.style.left = <span class="built_in">Math</span>.round(field.clientWidth / <span class="number">2</span>) + <span class="string">'px'</span>;</span><br><span class="line">&gt; ball.style.top = <span class="built_in">Math</span>.round(field.clientHeight / <span class="number">2</span>) + <span class="string">'px'</span>;</span><br><span class="line">&gt;</span><br></pre></table></figure></blockquote><blockquote><p>这是它的样子</p><iframe class="code-result__iframe" data-trusted="1" src="https://en.js.cx/task/put-ball-in-center/ball-half/" style="text-shadow:#999 .01em .01em .01em!important;display:block;border:0;width:732px;height:180px;font-family:微软雅黑!important"></iframe><p>To align the ball center with the center of the field, we should move the ball to the half of its width to the left and to the half of its height to the top:<p>为了让球在草坪上居中，我们应该将球左移自身宽度的一半，再上移自身宽度的一半：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre><td class="code"><pre><span class="line">&gt; ball.style.left = <span class="built_in">Math</span>.round(field.clientWidth / <span class="number">2</span> - ball.offsetWidth / <span class="number">2</span>) + <span class="string">'px'</span>;</span><br><span class="line">&gt; ball.style.top = <span class="built_in">Math</span>.round(field.clientHeight / <span class="number">2</span> - ball.offsetHeight / <span class="number">2</span>) + <span class="string">'px'</span>;</span><br><span class="line">&gt;</span><br></pre></table></figure></blockquote><blockquote><p><strong>注意：陷阱！</strong><p>当 <code>&lt;img&gt;</code> 没有 width/height 时这段代码不可用：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre><td class="code"><pre><span class="line">&gt; &lt;img src=&quot;ball.png&quot; id=&quot;ball&quot;&gt;</span><br><span class="line">&gt;</span><br></pre></table></figure></blockquote><blockquote><p>当浏览器不知道图片的 width/height 时（根据元素属性或者CSS），那么它会假设它们等于 <code>0</code> 直到图片完成加载。<p>在实际情况下，浏览器初次加载时常常会缓存图片，下次加载时它会立刻得到大小。<p>但是第一次加载时 <code>ball.offsetWidth</code> 的值时 <code>0</code> 。这会导致错误的坐标。<p>We should fix that by adding <code>width/height</code> to <code>&lt;img&gt;</code>:<p>我们应该通过给 <code>&lt;img&gt;</code> 添加 <code>width/height</code> 来解决:<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre><td class="code"><pre><span class="line">&gt; <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"ball.png"</span> <span class="attr">width</span>=<span class="string">"40"</span> <span class="attr">height</span>=<span class="string">"40"</span> <span class="attr">id</span>=<span class="string">"ball"</span>&gt;</span></span><br><span class="line">&gt;</span><br></pre></table></figure></blockquote><blockquote><p>…或者在 CSS 中提供大小：<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre><td class="code"><pre><span class="line">&gt; <span class="selector-id">#ball</span> &#123;</span><br><span class="line">&gt;   width: 40px;</span><br><span class="line">&gt;   <span class="selector-tag">height</span>: 40<span class="selector-tag">px</span>;</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br></pre></table></figure></blockquote><blockquote><p><a href="http://plnkr.co/edit/ntDEboGZLc2BgZ4DfiSE?p=preview" target="_blank" rel="noopener">在sandbox中查看答案</a></blockquote><h3 id="对比-CSS-width-VS-clientWidth">对比: CSS width VS clientWidth</h3><p>难度: 5<p><code>getComputedStyle(elem).width</code> 和<code>elem.clientWidth</code>有什么不同？<p>给出至少 3 个差异。越多越好。<blockquote><p>差异:<ol><li><code>clientWidth</code>是数值，而<code>getComputedStyle(elem).width</code> 返回一个以 <code>px</code> 结尾的字符串。<li><code>getComputedStyle</code> 可能对内联元素返回非数字，像 <code>&quot;auto&quot;</code>。<li><code>clientWidth</code> 是元素内部的内容区域加上内边距，而 CSS width (在标准 <code>box-sizing</code>下) 是内部内容区域 <em>不包含内边距</em>。<li>如果存在滚动条，并且浏览器保留了滚动条的空间，一些浏览器从 CSS width 减去滚动条宽度（导致内容宽度 受到影响），一些浏览器不会这样做。<code>clientWidth</code> 属性总是一致的：滚动条大小被减去了，如果保留了的话。</ol></blockquote></div><div><div class="my_post_copyright"><script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script><script type="text/javascript" src="https://code.jquery.com/jquery-1.7.1.min.js" integrity="sha256-iBcUE/x23aI6syuqF7EeT/+JFBxjPs5zeFJEXxumwb0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-sweetalert/1.0.1/sweetalert.min.js" integrity="sha256-JirYRqbf+qzfqVtEE4GETyHlAbiCpC005yBTa4rj6xg=" crossorigin="anonymous"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-sweetalert/1.0.1/sweetalert.min.css" integrity="sha256-zuyRv+YsWwh1XR5tsrZ7VCfGqUmmPmqBjIvJgQWoSDo=" crossorigin="anonymous"><p><span>本文标题:</span>CSS元素尺寸与滚动<p><span>文章作者:</span>kinboy<p><span>发布时间:</span>2018年12月02日 - 00:20:04<p><span>最后更新:</span>2019年07月15日 - 18:05:10<p><span>原始链接:</span><a href="/2018/12/02/CSS元素尺寸与滚动/" title="CSS元素尺寸与滚动">http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/</a><span class="copy-path" title="点击复制文章链接"></span><p><span>许可协议:</span> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</div><script>var clipboard=new Clipboard(".fa-clipboard");clipboard.on("success",$(function(){$(".fa-clipboard").click(function(){swal({title:"",text:"复制成功",html:!1,timer:500,showConfirmButton:!1})})}))</script></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">------ Passage Ending ------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author:</strong> kinboy<li class="post-copyright-link"><strong>Post link:</strong> <a href="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/" title="CSS元素尺寸与滚动">http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/</a><li class="post-copyright-license"><strong>Copyright Notice:</strong> All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> unless stating additionally.</ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/FE/" rel="tag"># FE</a> <a href="/tags/CSS/" rel="tag"># CSS</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2018/11/19/React用Index做列表的key值是反模式/" rel="next" title="React中用Index做列表的key值是反模式">React中用Index做列表的key值是反模式</a></div><div class="post-nav-prev post-nav-item"><a href="/2018/12/02/JavaScript现代模式，use-strict/" rel="prev" title="JavaScript现代模式，use strict">JavaScript现代模式，use strict</a></div></div></footer></div></article></div></div><div class="comments" id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">Table of Contents<li class="sidebar-nav-overview" data-target="site-overview-wrap">Overview</ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="kinboy"><p class="site-author-name" itemprop="name">kinboy</div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">66</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">31</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">52</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate">RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/kinboyw" target="_blank" title="GitHub">GitHub</a></span><span class="links-of-author-item"><a href="mailto:kinboy9275@gmail.com" target="_blank" title="E-Mail"> E-Mail</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#示例元素"><span class="nav-number">1.</span> <span class="nav-text">示例元素</span></a><li class="nav-item nav-level-2"><a class="nav-link" href="#几何"><span class="nav-number">2.</span> <span class="nav-text">几何</span></a><li class="nav-item nav-level-2"><a class="nav-link" href="#offsetParent-offsetLeft-Top"><span class="nav-number">3.</span> <span class="nav-text">offsetParent, offsetLeft/Top</span></a><li class="nav-item nav-level-2"><a class="nav-link" href="#offsetWidth-Height"><span class="nav-number">4.</span> <span class="nav-text">offsetWidth/Height</span></a><li class="nav-item nav-level-2"><a class="nav-link" href="#clientTop-Left"><span class="nav-number">5.</span> <span class="nav-text">clientTop/Left</span></a><li class="nav-item nav-level-2"><a class="nav-link" href="#clientWidth-Height"><span class="nav-number">6.</span> <span class="nav-text">clientWidth/Height</span></a><li class="nav-item nav-level-2"><a class="nav-link" href="#scrollWidth-Height"><span class="nav-number">7.</span> <span class="nav-text">scrollWidth/Height</span></a><li class="nav-item nav-level-2"><a class="nav-link" href="#scrollLeft-scrollTop"><span class="nav-number">8.</span> <span class="nav-text">scrollLeft/scrollTop</span></a><li class="nav-item nav-level-2"><a class="nav-link" href="#不要用-CSS-取-width-height"><span class="nav-number">9.</span> <span class="nav-text">不要用 CSS 取 width/height</span></a><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">10.</span> <span class="nav-text">总结</span></a><li class="nav-item nav-level-2"><a class="nav-link" href="#任务"><span class="nav-number">11.</span> <span class="nav-text">任务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#底部滚动距离是多少？"><span class="nav-number">11.1.</span> <span class="nav-text">底部滚动距离是多少？</span></a><li class="nav-item nav-level-3"><a class="nav-link" href="#滚动条宽度是多少？"><span class="nav-number">11.2.</span> <span class="nav-text">滚动条宽度是多少？</span></a><li class="nav-item nav-level-3"><a class="nav-link" href="#将球放到草坪中间"><span class="nav-number">11.3.</span> <span class="nav-text">将球放到草坪中间</span></a><li class="nav-item nav-level-3"><a class="nav-link" href="#对比-CSS-width-VS-clientWidth"><span class="nav-number">11.4.</span> <span class="nav-text">对比: CSS width VS clientWidth</span></a></ol></ol></div></div></section><div class="back-to-top"><span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span><span class="with-love"></span> <span class="author" itemprop="copyrightHolder">kinboy</span><br><img src="/images/beian.png"> <span style="width:300px;margin:0 auto;padding:20px 0"><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42011102002861" style="display:inline-block;text-decoration:none;height:20px;line-height:20px"><img src style="float:left"><p style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#939393">鄂公网安备 42011102002861号</p></a></span></div></div></footer></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/three/three.min.js"></script><script type="text/javascript" src="/lib/three/canvas_sphere.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script id="dsq-count-scr" src="https://kinboy-wang.disqus.com/count.js" async></script><script type="text/javascript">var disqus_config=function(){this.page.url="http://kinboyw.github.io/2018/12/02/CSS元素尺寸与滚动/",this.page.identifier="2018/12/02/CSS元素尺寸与滚动/",this.page.title="CSS元素尺寸与滚动"},d=document,s=d.createElement("script");s.src="https://kinboy-wang.disqus.com/embed.js",s.setAttribute("data-timestamp",""+ +new Date),(d.head||d.body).appendChild(s)</script><script type="text/javascript">// Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>